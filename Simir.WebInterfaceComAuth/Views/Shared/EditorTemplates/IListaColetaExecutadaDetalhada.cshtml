@model IList<Simir.Application.ViewModels.ListaDetalhamentoColetaVM>

@using Simir.WebInterfaceComAuth.Helpers

@{
    string nmPropriedade = ViewData.ModelMetadata.PropertyName;
}

<div id="@nmPropriedade" class="panel panel-default EquipamentosVM">
    <div class="panel-heading">
        @ViewData.ModelMetadata.DisplayName
    </div>
    <div class="panel-body">

        @*-----------------------------Primeira Linha----------------------------*@
        <div class="row" style="margin-left:1%;">
            <div class="col-xs-5">
                <div class="form-group row">
                    <label>Horário de chegada</label>
                    <div class="input-group col-xs-2">
                        <input class="inpHoraChegadaRota form-control" data-mask="00:00" data-mask-reverse="True" type="text" value="" autocomplete="off">
                    </div>
                </div>
            </div>
            <div class="col-xs-5">
                <div class="form-group row">
                    <label>Placa do Veículo da coleta:</label>
                    <div class="input-group col-xs-3">
                        <input class="inpPlacaVeiculo form-control" maxlength="7" type="text" value="" autocomplete="off">
                    </div>
                </div>
            </div>
            <div class="form-group col-xs-2">
                <label> </label>
                <div class="input-group">
                    <div class="btn btn-primary btnAddEquipamento">
                        <i class="fa fa-plus-circle "></i> Incluir
                    </div>
                </div>
            </div>
        </div>

        @*-----------------------------Segunda Linha-------------------------*@
        <div class="row" style="margin-left:1%;">
            <div class="col-xs-12">
                <div class="form-group row">
                    <label>Local de enchimento do veículo durante a viagem</label>
                    <div class="input-group  col-xs-11">
                        <input class="inpLocalEnchimentoCaminhao form-control text-left  valid" maxlength="140" type="text" value="" autocomplete="off">
                    </div>
                </div>
            </div>
        </div>

        @*-----------------------Terceira Linha---------------------------*@
        <div class="row" style="margin-left:1%;">
            <div class="col-xs-6">
                <div class="form-group row">
                    <label>Extensão percorrida até o ponto de enchimento do caminhão</label>
                    <div class="input-group  col-xs-3">
                        <input class="inpExtensaoPercorridaEnchimento form-control text-right valid" data-mask="000.000.000" data-mask-reverse="True" type="text" value="" autocomplete="off">
                    </div>
                </div>
            </div>
            <div class="col-xs-3">
                <div class="form-group row">
                    <label>Horário de enchimento do veículo</label>
                    <div class="input-group  col-xs-4">
                        <input class="inpHoraEnchimento form-control text-right valid" data-mask="00:00" data-mask-reverse="True" type="text" value="" autocomplete="off">
                    </div>
                </div>
            </div>
            
        </div>

        @*-----------------------Quarta Linha---------------------------*@
        <div class="row" style="margin-left:1%;">
            <div class="col-xs-6">
                <div class="form-group row">
                    <label>Horário de chegada no local de descarga</label>
                    <div class="input-group  col-xs-3">
                        <input class="inphoraChegadaLocalDescarga form-control text-right valid" data-mask="00:00" data-mask-reverse="True" type="text" value="" autocomplete="off">
                    </div>
                </div>
            </div>
            <div class="col-xs-3">
                <div class="form-group row">
                    <label>Quantidade de resíduo descarregada</label>
                    <div class="input-group  col-xs-6">
                        <input class="inpQtResiduo form-control text-right valid" data-mask="000.000.000" data-mask-reverse="True" type="text" value="" autocomplete="off">
                    </div>
                </div>
            </div>
            <div class="col-xs-3">
                <div class="form-group row">
                    
                    <div class="form-group col-md-12">
                        <label>Medida</label>
                        <br />
                        <div class="radio-inline">
                            <label>
                                <input checked="checked" id="Medida" name="Medida" type="radio" value="True"> litro
                            </label>
                        </div>
                        <div class="radio-inline">
                            <label>
                                <input checked="checked" id="" name="Medida" type="radio" value="False"> Kg
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div>
        <table class="table">
            <thead>
                <tr>
                    <th>Placa do Veículo</th>
                    <th>Hr de Chegada</th>
                    <th>Local Enchimento</th>
                    <th>Extensão Percorrida</th>
                    <th>Hr de Enchimento</th>
                    <th>Hr de Chegada no Descarte</th>
                    <th>Qnte. Resíduo</th>
                    <th>Medida</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>

                @for (int i = 0; i < Model.Count; i++)
                {
                    <tr>
                        <td class="tdPlacaVeiculo col-xs-1">
                            <span>@Model[i].PlacaVeiculo</span>
                            <input class="ínpPlacaVeiculo" type="hidden" name="@String.Format("{0}[{1}].PlacaVeiculo", nmPropriedade, i)" value="@Model[i].PlacaVeiculo" />
                        </td>
                        <td class="tdHoraChegadaRota col-xs-1">
                            <span>@Model[i].HoraChegadaRota</span>
                            <input class="inpHoraChegadaRota" type="hidden" name="@String.Format("{0}[{1}].HoraChegadaRota", nmPropriedade, i)" value="@Model[i].HoraChegadaRota" />
                        </td>
                        <td class="tdLocalEnchimentoCaminhao col-xs-4">
                            <span>@Model[i].LocalEnchimentoCaminhao</span>
                            <input class="inpLocalEnchimentoCaminhao" type="hidden" name="@String.Format("{0}[{1}].LocalEnchimentoCaminhao", nmPropriedade, i)" value="@Model[i].LocalEnchimentoCaminhao" />
                        </td>
                        <td class="tdExtensaoPercorridaEnchimento col-xs-1">
                            <span>@Model[i].ExtensaoPercorridaEnchimento</span>
                            <input class="inpExtensaoPercorridaEnchimento" type="hidden" name="@String.Format("{0}[{1}].ExtensaoPercorridaEnchimento", nmPropriedade, i)" value="@Model[i].ExtensaoPercorridaEnchimento" />
                        </td>
                        <td class="tdHoraEnchimento col-xs-1">
                            <span>@Model[i].HoraEnchimento</span>
                            <input class="inpHoraEnchimento" type="hidden" name="@String.Format("{0}[{1}].HoraEnchimento", nmPropriedade, i)" value="@Model[i].HoraEnchimento" />
                        </td>
                        <td class="tdhoraChegadaLocalDescarga col-xs-2">
                            <span>@Model[i].horaChegadaLocalDescarga</span>
                            <input class="inphoraChegadaLocalDescarga" type="hidden" name="@String.Format("{0}[{1}].horaChegadaLocalDescarga", nmPropriedade, i)" value="@Model[i].horaChegadaLocalDescarga" />
                        </td>
                        <td class="tdQtResiduo col-xs-1">
                            <span>@Model[i].QtResiduo</span>
                            <input class="inpQtResiduo" type="hidden" name="@String.Format("{0}[{1}].QtResiduo", nmPropriedade, i)" value="@Model[i].QtResiduo" />
                        </td>
                        <td class="col-xs-">
                            <span>@Model[i].bLitro</span>
                            <input class="" type="hidden" name="@String.Format("{0}[{1}].bLitro", nmPropriedade, i)" value="@Model[i].bLitro" />
                        </td>
                        <td class="col-xs-2">
                            <input class="inpColetaExecutadaID" type="hidden" name="@String.Format("{0}[{1}].ColetaExecutadaID", nmPropriedade, i)" value="@Model[i].ColetaExecutadaID" />
                            <input class="inpColetaExecutadaDetalhadaID" type="hidden" name="@String.Format("{0}[{1}].ColetaExecutadaDetalhadaID", nmPropriedade, i)" value="@Model[i].ColetaExecutadaDetalhadaID" />
                            <input class="inpExcluir" type="hidden" name="@String.Format("{0}[{1}].Status", nmPropriedade, i)" value="1" />

                            <div class="btn btn-danger btnExcluir">
                                <i class="fa fa-trash-o"></i>
                            </div>
                        </td>
                    </tr>
                }

            </tbody>
        </table>
    </div>

</div>


@using (Html.BeginScriptContext())
{
    Html.AddScriptBlock(
        @<script type="text/javascript">
    $(".btnExcluir", "#@nmPropriedade").click(
    function () {
        var linha = $(this).closest('tr');
        linha.find(".inpExcluir").val('8');
        linha.hide();
    });

    $("input:text", "#@nmPropriedade .linhapronta").change(
    function () {
        var linha = $(this).closest('tr');
        linha.find(".inpExcluir").val('2');
    });

    $(".btnAddEquipamento", "#@nmPropriedade").click(
    function () {
        var tabela = $(this).closest(".EquipamentosVM").find("tbody")
        var i = $('tr', tabela).length;

        var prefixo = '@nmPropriedade' + '[' + i + ']';

        var PlacaVeiculo = $(".inpPlacaVeiculo", "#@nmPropriedade").val();
        var HoraChegadaRota = $(".inpHoraChegadaRota", "#@nmPropriedade").val();
        var LocalEnchimentoCaminhao = $(".inpLocalEnchimentoCaminhao", "#@nmPropriedade").val();
        var ExtensaoPercorridaEnchimento = $(".inpExtensaoPercorridaEnchimento", "#@nmPropriedade").val();
        var HoraEnchimento = $(".inpHoraEnchimento", "#@nmPropriedade").val();
        var horaChegadaLocalDescarga = $(".inphoraChegadaLocalDescarga", "#@nmPropriedade").val();
        var QtResiduo = $(".inpQtResiduo", "#@nmPropriedade").val();

        var bLitro = 'False';
        var bLitroLabel = 'Kg';
        if ($("input[name='Medida']:checked").val() == 'True') {
            bLitro = 'True';
            bLitroLabel = 'litro';
        }

        $(".inpPlacaVeiculo", "#@nmPropriedade").val('');
        $(".inpHoraChegadaRota", "#@nmPropriedade").val('');
        $(".inpLocalEnchimentoCaminhao", "#@nmPropriedade").val('');
        $(".inpExtensaoPercorridaEnchimento", "#@nmPropriedade").val('');
        $(".inpHoraEnchimento", "#@nmPropriedade").val('');
        $(".inphoraChegadaLocalDescarga", "#@nmPropriedade").val('');
        $(".inpQtResiduo", "#@nmPropriedade").val('');

        tabela.append('<tr>' +
                        '<td class="tdPlacaVeiculo col-xs-1">' +
                            '<span>' + PlacaVeiculo + '</span>' +
                            '<input class="ínpPlacaVeiculo" type="hidden" name="' + prefixo + '.PlacaVeiculo" value="' + PlacaVeiculo + '" />' +
                        '</td>' +
                        '<td class="tdHoraChegadaRota col-xs-1">' +
                            '<span>' + HoraChegadaRota + '</span>' +
                            '<input class="inpHoraChegadaRota" type="hidden" name="' + prefixo + '.HoraChegadaRota" value="' + HoraChegadaRota + '" />' +
                        '</td>' +
                        '<td class="tdLocalEnchimentoCaminhao col-xs-4">' +
                            '<span>' + LocalEnchimentoCaminhao + '</span>' +
                            '<input class="inpLocalEnchimentoCaminhao" type="hidden" name="' + prefixo + '.LocalEnchimentoCaminhao" value="' + LocalEnchimentoCaminhao + '" />' +
                        '</td>' +
                        '<td class="tdExtensaoPercorridaEnchimento col-xs-1">' +
                            '<span>' + ExtensaoPercorridaEnchimento + '</span>' +
                            '<input class="inpExtensaoPercorridaEnchimento" type="hidden" name="' + prefixo + '.ExtensaoPercorridaEnchimento" value="' + ExtensaoPercorridaEnchimento + '" />' +
                        '</td>' +
                        '<td class="tdHoraEnchimento col-xs-1">' +
                            '<span>' + HoraEnchimento + '</span>' +
                            '<input class="inpHoraEnchimento" type="hidden" name="' + prefixo + '.HoraEnchimento" value="' + HoraEnchimento + '" />' +
                        '</td>' +
                        '<td class="tdhoraChegadaLocalDescarga col-xs-2">' +
                            '<span>' + horaChegadaLocalDescarga + '</span>' +
                            '<input class="inphoraChegadaLocalDescarga" type="hidden" name="' + prefixo + '.horaChegadaLocalDescarga" value="' + horaChegadaLocalDescarga + '" />' +
                        '</td>' +
                        '<td class="tdQtResiduo col-xs-1">' +
                            '<span>' + QtResiduo + '</span>' +
                            '<input class="inpQtResiduo" type="hidden" name="' + prefixo + '.QtResiduo"" value="' + QtResiduo + '" />' +
                        '</td>' +
                        '<td class=" col-xs-1">' +
                            '<span>' + bLitroLabel + '</span>' +
                            '<input class="" type="hidden" name="' + prefixo + '.bLitro"" value="' + bLitro + '" />' +
                        '</td>' +
                        '<td class="col-xs-2">' +
                            '<input class="inpColetaExecutadaID" type="hidden" name="' + prefixo + '.ColetaExecutadaID" value="0" />' +
                            '<input class="inpColetaExecutadaDetalhadaID" type="hidden" name="' + prefixo + '.ColetaExecutadaDetalhadaID" value="0" />' +
                            '<input class="inpExcluir" type="hidden" name="' + prefixo + '.Status" value="4" />' +

                            '<div class="btn btn-danger btnExcluir">' +
                                '<i class="fa fa-trash-o"></i>' +
                            '</div>' +
                        '</td>' +
                    '</tr>');


        ultimalinha = $('tr', tabela).last();

        ultimalinha.find('.btnExcluir').click(
        function () {
            var linha = $(this).closest('tr');
            linha.remove();
        });

        $.applyDataMask(ultimalinha.find('.inpHoraChegadaRota'));
        $.applyDataMask(ultimalinha.find('.inpExtensaoPercorridaEnchimento'));

        $.applyDataMask(ultimalinha.find('.inpHoraEnchimento'));

        $.applyDataMask(ultimalinha.find('.inphoraChegadaLocalDescarga'));
        $.applyDataMask(ultimalinha.find('.inpQtResiduo'));

    });


        </script>
, false);
}

